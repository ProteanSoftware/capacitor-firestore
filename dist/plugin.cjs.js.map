{"version":3,"file":"plugin.cjs.js","sources":["esm/definitions.js","esm/index.js","esm/web.js"],"sourcesContent":["/// <reference types=\"@capacitor/cli\" />\r\nexport function createQueryConstraint(field, operator, value) {\r\n    return {\r\n        fieldPath: field,\r\n        opStr: operator,\r\n        value: value\r\n    };\r\n}\r\n//# sourceMappingURL=definitions.js.map","import { registerPlugin } from '@capacitor/core';\r\nimport { createQueryConstraint } from './definitions';\r\nconst CapacitorFirestore = registerPlugin('CapacitorFirestore', {\r\n    web: () => import('./web').then(m => new m.CapacitorFirestoreWeb()),\r\n});\r\nexport * from './definitions';\r\nexport { CapacitorFirestore, createQueryConstraint };\r\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\r\nimport { initializeApp, deleteApp } from \"firebase/app\";\r\nimport { getAuth, signInWithCustomToken } from \"firebase/auth\";\r\nimport { initializeFirestore, terminate, enableIndexedDbPersistence, onSnapshot, doc, getDoc, getDocs, collection, query, where, CACHE_SIZE_UNLIMITED } from \"firebase/firestore\";\r\nexport class CapacitorFirestoreWeb extends WebPlugin {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.app = null;\r\n        this.firestore = null;\r\n        this.subscriptions = {};\r\n    }\r\n    initializeFirestore(options) {\r\n        let teardownPromise = Promise.resolve();\r\n        if (this.firestore !== null) {\r\n            teardownPromise = terminate(this.firestore);\r\n        }\r\n        teardownPromise = teardownPromise.then(() => {\r\n            if (this.app !== null) {\r\n                deleteApp(this.app);\r\n            }\r\n        });\r\n        const initPromise = teardownPromise.then(() => {\r\n            const app = initializeApp({\r\n                apiKey: options.apiKey,\r\n                appId: options.applicationId,\r\n                projectId: options.projectId\r\n            }, \"CapacitorFirestore\");\r\n            this.app = app;\r\n            const firestore = initializeFirestore(app, {\r\n                cacheSizeBytes: CACHE_SIZE_UNLIMITED\r\n            });\r\n            return firestore;\r\n        });\r\n        return initPromise.then(firestore => {\r\n            enableIndexedDbPersistence(firestore).then(() => {\r\n                this.firestore = firestore;\r\n            });\r\n        });\r\n    }\r\n    addDocumentSnapshotListener(options, callback) {\r\n        if (this.firestore === null) {\r\n            return Promise.reject(\"Firestore not initialized\");\r\n        }\r\n        const unSubFunc = onSnapshot(doc(this.firestore, options.reference), snapshot => {\r\n            callback({\r\n                id: snapshot.id,\r\n                data: snapshot.exists() ? snapshot.data() : null\r\n            });\r\n        });\r\n        const id = new Date().getTime().toString();\r\n        this.subscriptions[id] = unSubFunc;\r\n        return Promise.resolve(id);\r\n    }\r\n    getDocument(options) {\r\n        if (this.firestore === null) {\r\n            return Promise.reject(\"Firestore not initialized\");\r\n        }\r\n        return getDoc(doc(this.firestore, options.reference)).then(snapshot => {\r\n            return {\r\n                id: snapshot.id,\r\n                data: snapshot.exists() ? snapshot.data() : null\r\n            };\r\n        });\r\n    }\r\n    addCollectionSnapshotListener(options, callback) {\r\n        if (this.firestore === null) {\r\n            return Promise.reject(\"Firestore not initialized\");\r\n        }\r\n        let collectionQuery;\r\n        if (options.queryConstraints) {\r\n            const constraints = options.queryConstraints.map(constraint => where(constraint.fieldPath, constraint.opStr, constraint.value));\r\n            collectionQuery = query(collection(this.firestore, options.reference), ...constraints);\r\n        }\r\n        else {\r\n            collectionQuery = query(collection(this.firestore, options.reference));\r\n        }\r\n        const unSubFunc = onSnapshot(collectionQuery, snapshot => {\r\n            callback({\r\n                collection: snapshot.docs.map(doc => {\r\n                    return {\r\n                        id: doc.id,\r\n                        data: doc.data()\r\n                    };\r\n                })\r\n            });\r\n        });\r\n        const id = new Date().getTime().toString();\r\n        this.subscriptions[id] = unSubFunc;\r\n        return Promise.resolve(id);\r\n    }\r\n    getCollection(options) {\r\n        if (this.firestore === null) {\r\n            return Promise.reject(\"Firestore not initialized\");\r\n        }\r\n        let collectionQuery;\r\n        if (options.queryConstraints) {\r\n            const constraints = options.queryConstraints.map(constraint => where(constraint.fieldPath, constraint.opStr, constraint.value));\r\n            collectionQuery = query(collection(this.firestore, options.reference), ...constraints);\r\n        }\r\n        else {\r\n            collectionQuery = query(collection(this.firestore, options.reference));\r\n        }\r\n        return getDocs(collectionQuery).then(snapshot => {\r\n            return {\r\n                collection: snapshot.docs.map(doc => {\r\n                    return {\r\n                        id: doc.id,\r\n                        data: doc.data()\r\n                    };\r\n                })\r\n            };\r\n        });\r\n    }\r\n    removeSnapshotListener(options) {\r\n        const unSubFunc = this.subscriptions[options.callbackId];\r\n        if (unSubFunc === undefined) {\r\n            return Promise.reject(\"No callback with id \" + options.callbackId);\r\n        }\r\n        unSubFunc();\r\n        delete this.subscriptions[options.callbackId];\r\n        return Promise.resolve();\r\n    }\r\n    signInWithCustomToken(options) {\r\n        if (this.app === null) {\r\n            return Promise.reject(\"app not initialized\");\r\n        }\r\n        const auth = getAuth(this.app);\r\n        return signInWithCustomToken(auth, options.token).then();\r\n    }\r\n}\r\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin","terminate","deleteApp","app","initializeApp","firestore","initializeFirestore","CACHE_SIZE_UNLIMITED","enableIndexedDbPersistence","onSnapshot","doc","getDoc","where","query","collection","getDocs","auth","getAuth","signInWithCustomToken"],"mappings":";;;;;;;;;AAAA;AACO,SAAS,qBAAqB,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE;AAC9D,IAAI,OAAO;AACX,QAAQ,SAAS,EAAE,KAAK;AACxB,QAAQ,KAAK,EAAE,QAAQ;AACvB,QAAQ,KAAK,EAAE,KAAK;AACpB,KAAK,CAAC;AACN;;ACLK,MAAC,kBAAkB,GAAGA,mBAAc,CAAC,oBAAoB,EAAE;AAChE,IAAI,GAAG,EAAE,MAAM,mDAAe,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,qBAAqB,EAAE,CAAC;AACvE,CAAC;;ACAM,MAAM,qBAAqB,SAASC,cAAS,CAAC;AACrD,IAAI,WAAW,GAAG;AAClB,QAAQ,KAAK,CAAC,GAAG,SAAS,CAAC,CAAC;AAC5B,QAAQ,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;AACxB,QAAQ,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AAC9B,QAAQ,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;AAChC,KAAK;AACL,IAAI,mBAAmB,CAAC,OAAO,EAAE;AACjC,QAAQ,IAAI,eAAe,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;AAChD,QAAQ,IAAI,IAAI,CAAC,SAAS,KAAK,IAAI,EAAE;AACrC,YAAY,eAAe,GAAGC,mBAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;AACxD,SAAS;AACT,QAAQ,eAAe,GAAG,eAAe,CAAC,IAAI,CAAC,MAAM;AACrD,YAAY,IAAI,IAAI,CAAC,GAAG,KAAK,IAAI,EAAE;AACnC,gBAAgBC,aAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACpC,aAAa;AACb,SAAS,CAAC,CAAC;AACX,QAAQ,MAAM,WAAW,GAAG,eAAe,CAAC,IAAI,CAAC,MAAM;AACvD,YAAY,MAAMC,KAAG,GAAGC,iBAAa,CAAC;AACtC,gBAAgB,MAAM,EAAE,OAAO,CAAC,MAAM;AACtC,gBAAgB,KAAK,EAAE,OAAO,CAAC,aAAa;AAC5C,gBAAgB,SAAS,EAAE,OAAO,CAAC,SAAS;AAC5C,aAAa,EAAE,oBAAoB,CAAC,CAAC;AACrC,YAAY,IAAI,CAAC,GAAG,GAAGD,KAAG,CAAC;AAC3B,YAAY,MAAME,WAAS,GAAGC,6BAAmB,CAACH,KAAG,EAAE;AACvD,gBAAgB,cAAc,EAAEI,8BAAoB;AACpD,aAAa,CAAC,CAAC;AACf,YAAY,OAAOF,WAAS,CAAC;AAC7B,SAAS,CAAC,CAAC;AACX,QAAQ,OAAO,WAAW,CAAC,IAAI,CAACA,WAAS,IAAI;AAC7C,YAAYG,oCAA0B,CAACH,WAAS,CAAC,CAAC,IAAI,CAAC,MAAM;AAC7D,gBAAgB,IAAI,CAAC,SAAS,GAAGA,WAAS,CAAC;AAC3C,aAAa,CAAC,CAAC;AACf,SAAS,CAAC,CAAC;AACX,KAAK;AACL,IAAI,2BAA2B,CAAC,OAAO,EAAE,QAAQ,EAAE;AACnD,QAAQ,IAAI,IAAI,CAAC,SAAS,KAAK,IAAI,EAAE;AACrC,YAAY,OAAO,OAAO,CAAC,MAAM,CAAC,2BAA2B,CAAC,CAAC;AAC/D,SAAS;AACT,QAAQ,MAAM,SAAS,GAAGI,oBAAU,CAACC,aAAG,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,SAAS,CAAC,EAAE,QAAQ,IAAI;AACzF,YAAY,QAAQ,CAAC;AACrB,gBAAgB,EAAE,EAAE,QAAQ,CAAC,EAAE;AAC/B,gBAAgB,IAAI,EAAE,QAAQ,CAAC,MAAM,EAAE,GAAG,QAAQ,CAAC,IAAI,EAAE,GAAG,IAAI;AAChE,aAAa,CAAC,CAAC;AACf,SAAS,CAAC,CAAC;AACX,QAAQ,MAAM,EAAE,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC,QAAQ,EAAE,CAAC;AACnD,QAAQ,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC;AAC3C,QAAQ,OAAO,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;AACnC,KAAK;AACL,IAAI,WAAW,CAAC,OAAO,EAAE;AACzB,QAAQ,IAAI,IAAI,CAAC,SAAS,KAAK,IAAI,EAAE;AACrC,YAAY,OAAO,OAAO,CAAC,MAAM,CAAC,2BAA2B,CAAC,CAAC;AAC/D,SAAS;AACT,QAAQ,OAAOC,gBAAM,CAACD,aAAG,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,IAAI;AAC/E,YAAY,OAAO;AACnB,gBAAgB,EAAE,EAAE,QAAQ,CAAC,EAAE;AAC/B,gBAAgB,IAAI,EAAE,QAAQ,CAAC,MAAM,EAAE,GAAG,QAAQ,CAAC,IAAI,EAAE,GAAG,IAAI;AAChE,aAAa,CAAC;AACd,SAAS,CAAC,CAAC;AACX,KAAK;AACL,IAAI,6BAA6B,CAAC,OAAO,EAAE,QAAQ,EAAE;AACrD,QAAQ,IAAI,IAAI,CAAC,SAAS,KAAK,IAAI,EAAE;AACrC,YAAY,OAAO,OAAO,CAAC,MAAM,CAAC,2BAA2B,CAAC,CAAC;AAC/D,SAAS;AACT,QAAQ,IAAI,eAAe,CAAC;AAC5B,QAAQ,IAAI,OAAO,CAAC,gBAAgB,EAAE;AACtC,YAAY,MAAM,WAAW,GAAG,OAAO,CAAC,gBAAgB,CAAC,GAAG,CAAC,UAAU,IAAIE,eAAK,CAAC,UAAU,CAAC,SAAS,EAAE,UAAU,CAAC,KAAK,EAAE,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC;AAC5I,YAAY,eAAe,GAAGC,eAAK,CAACC,oBAAU,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,SAAS,CAAC,EAAE,GAAG,WAAW,CAAC,CAAC;AACnG,SAAS;AACT,aAAa;AACb,YAAY,eAAe,GAAGD,eAAK,CAACC,oBAAU,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;AACnF,SAAS;AACT,QAAQ,MAAM,SAAS,GAAGL,oBAAU,CAAC,eAAe,EAAE,QAAQ,IAAI;AAClE,YAAY,QAAQ,CAAC;AACrB,gBAAgB,UAAU,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI;AACrD,oBAAoB,OAAO;AAC3B,wBAAwB,EAAE,EAAE,GAAG,CAAC,EAAE;AAClC,wBAAwB,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE;AACxC,qBAAqB,CAAC;AACtB,iBAAiB,CAAC;AAClB,aAAa,CAAC,CAAC;AACf,SAAS,CAAC,CAAC;AACX,QAAQ,MAAM,EAAE,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC,QAAQ,EAAE,CAAC;AACnD,QAAQ,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC;AAC3C,QAAQ,OAAO,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;AACnC,KAAK;AACL,IAAI,aAAa,CAAC,OAAO,EAAE;AAC3B,QAAQ,IAAI,IAAI,CAAC,SAAS,KAAK,IAAI,EAAE;AACrC,YAAY,OAAO,OAAO,CAAC,MAAM,CAAC,2BAA2B,CAAC,CAAC;AAC/D,SAAS;AACT,QAAQ,IAAI,eAAe,CAAC;AAC5B,QAAQ,IAAI,OAAO,CAAC,gBAAgB,EAAE;AACtC,YAAY,MAAM,WAAW,GAAG,OAAO,CAAC,gBAAgB,CAAC,GAAG,CAAC,UAAU,IAAIG,eAAK,CAAC,UAAU,CAAC,SAAS,EAAE,UAAU,CAAC,KAAK,EAAE,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC;AAC5I,YAAY,eAAe,GAAGC,eAAK,CAACC,oBAAU,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,SAAS,CAAC,EAAE,GAAG,WAAW,CAAC,CAAC;AACnG,SAAS;AACT,aAAa;AACb,YAAY,eAAe,GAAGD,eAAK,CAACC,oBAAU,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;AACnF,SAAS;AACT,QAAQ,OAAOC,iBAAO,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,QAAQ,IAAI;AACzD,YAAY,OAAO;AACnB,gBAAgB,UAAU,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI;AACrD,oBAAoB,OAAO;AAC3B,wBAAwB,EAAE,EAAE,GAAG,CAAC,EAAE;AAClC,wBAAwB,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE;AACxC,qBAAqB,CAAC;AACtB,iBAAiB,CAAC;AAClB,aAAa,CAAC;AACd,SAAS,CAAC,CAAC;AACX,KAAK;AACL,IAAI,sBAAsB,CAAC,OAAO,EAAE;AACpC,QAAQ,MAAM,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;AACjE,QAAQ,IAAI,SAAS,KAAK,SAAS,EAAE;AACrC,YAAY,OAAO,OAAO,CAAC,MAAM,CAAC,sBAAsB,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAC/E,SAAS;AACT,QAAQ,SAAS,EAAE,CAAC;AACpB,QAAQ,OAAO,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;AACtD,QAAQ,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;AACjC,KAAK;AACL,IAAI,qBAAqB,CAAC,OAAO,EAAE;AACnC,QAAQ,IAAI,IAAI,CAAC,GAAG,KAAK,IAAI,EAAE;AAC/B,YAAY,OAAO,OAAO,CAAC,MAAM,CAAC,qBAAqB,CAAC,CAAC;AACzD,SAAS;AACT,QAAQ,MAAMC,MAAI,GAAGC,YAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACvC,QAAQ,OAAOC,0BAAqB,CAACF,MAAI,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,IAAI,EAAE,CAAC;AACjE,KAAK;AACL;;;;;;;;;;"}